

{% extends "base.html" %}

{% block title %}Edit Scenario{% endblock %}

{% block content %}
<div class="container">
    <h1>Edit Scenario</h1>
    <form method="POST" action="{{ url_for('edit_scenario', scenario_name=scenario_name) }}">
        <div class="form-group">
            <label for="scenario_name">Scenario Name:</label>
            <input type="text" class="form-control" id="scenario_name" name="scenario_name" value="{{ scenario_name }}" required>
        </div>
        <div class="form-group">
            <label for="description">Description:</label>
            <textarea class="form-control" id="description" name="description" rows="3">{{ scenario.description }}</textarea>
        </div>
        <div class="form-group">
            <label for="devices">Devices:</label>
            <div class="mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="device_selection" id="select_individual" value="individual" checked>
                    <label class="form-check-label" for="select_individual">Select individual devices</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="device_selection" id="select_group" value="group">
                    <label class="form-check-label" for="select_group">Select device groups</label>
                </div>
            </div>
            
            <!-- Individual devices selection -->
            <div id="individual_devices">
                <select class="form-select" id="devices" name="devices" multiple size="8">
                    {% for device_name, device in devices.items() %}
                    <option value="{{ device_name }}" {% if device_name in scenario.devices %}selected{% endif %}>
                        {{ device_name }} ({{ device.group }})
                    </option>
                    {% endfor %}
                </select>
                <small class="form-text text-muted">Hold Ctrl/Cmd to select multiple devices</small>
            </div>
            
            <!-- Device groups selection -->
            <div id="device_groups" style="display: none;">
                <select class="form-select" id="device_groups" name="device_groups" multiple size="8">
                    {% for device_name, device in devices.items() %}
                    <option value="{{ device.group }}" {% if device.group in scenario.device_groups|default([]) %}selected{% endif %}>
                        {{ device.group }}
                    </option>
                    {% endfor %}
                </select>
                <small class="form-text text-muted">Hold Ctrl/Cmd to select multiple groups</small>
            </div>
        </div>
        <div class="form-group">
            <label for="commands">Commands (comma separated):</label>
            <textarea class="form-control" id="commands" name="commands" rows="5">{{ scenario.commands|join(', ') }}</textarea>
        </div>
        <div class="form-group">
            <label for="group">Group:</label>
            <input type="text" class="form-control" id="group" name="group" value="{{ scenario.group }}">
        </div>
        <div class="form-group">
            <label for="delay">Delay between commands (seconds):</label>
            <input type="number" class="form-control" id="delay" name="delay" value="{{ scenario.delay|default(2) }}" min="0" step="1">
        </div>
        <div class="form-group">
            <label for="timeout">Timeout (seconds):</label>
            <input type="number" class="form-control" id="timeout" name="timeout" value="{{ scenario.timeout|default(30) }}" min="1" step="1">
        </div>
        <div class="form-group">
            <label for="save_config">Save Configuration:</label>
            <select class="form-control" id="save_config" name="save_config">
                <option value="true" {% if scenario.save_config|default(false) %}selected{% endif %}>Yes</option>
                <option value="false" {% if not scenario.save_config|default(false) %}selected{% endif %}>No</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Update Scenario</button>
        <a href="{{ url_for('scenarios') }}" class="btn btn-secondary">Cancel</a>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const individualRadio = document.getElementById('select_individual');
    const groupRadio = document.getElementById('select_group');
    const individualDevices = document.getElementById('individual_devices');
    const deviceGroups = document.getElementById('device_groups');

    function toggleDeviceSelection() {
        if (individualRadio.checked) {
            individualDevices.style.display = 'block';
            deviceGroups.style.display = 'none';
        } else {
            individualDevices.style.display = 'none';
            deviceGroups.style.display = 'block';
        }
    }

    individualRadio.addEventListener('change', toggleDeviceSelection);
    groupRadio.addEventListener('change', toggleDeviceSelection);
});
</script>
{% endblock %}


