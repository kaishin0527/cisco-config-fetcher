

{% extends "base.html" %}

{% block title %}Edit Scenario{% endblock %}

{% block content %}
<div class="container">
    <h1>Edit Scenario</h1>
    <form method="POST" action="{{ url_for('edit_scenario', scenario_name=scenario_name) }}">
        <div class="form-group">
            <label for="scenario_name">Scenario Name:</label>
            <input type="text" class="form-control" id="scenario_name" name="scenario_name" value="{{ scenario_name }}" required>
        </div>
        <div class="form-group">
            <label for="description">Description:</label>
            <textarea class="form-control" id="description" name="description" rows="3">{{ scenario.description }}</textarea>
        </div>
        <div class="form-group">
            <label for="devices">Devices:</label>
            <div class="mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="device_selection" id="select_individual" value="individual" checked>
                    <label class="form-check-label" for="select_individual">Select individual devices</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="device_selection" id="select_group" value="group">
                    <label class="form-check-label" for="select_group">Select device groups</label>
                </div>
            </div>
            
            <!-- Individual devices selection -->
            <div id="individual_devices">
                <div class="row">
                    {% for device_name, device in devices.items() %}
                    <div class="col-md-6 mb-2">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="individual_devices" id="device_{{ device_name }}" value="{{ device_name }}" {% if device_name in scenario.devices %}checked{% endif %}>
                            <label class="form-check-label" for="device_{{ device_name }}">
                                {{ device_name }} ({{ device.group }})
                            </label>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <small class="form-text text-muted">Select multiple individual devices</small>
            </div>
            
            <!-- Device groups selection -->
            <div id="device_groups" style="display: none;">
                <div class="row">
                    {% for group in device_groups|unique %}
                    <div class="col-md-6 mb-2">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="device_groups" id="group_{{ group }}" value="{{ group }}" {% if group in scenario.device_groups|default([]) %}checked{% endif %}>
                            <label class="form-check-label" for="group_{{ group }}">
                                {{ group }}
                            </label>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <small class="form-text text-muted">Select multiple device groups</small>
            </div>
        </div>
        <div class="form-group">
            <label for="commands">Commands (comma separated):</label>
            <textarea class="form-control" id="commands" name="commands" rows="5">{{ scenario.commands|join(', ') }}</textarea>
        </div>
        <div class="form-group">
            <label for="group">Group:</label>
            <input type="text" class="form-control" id="group" name="group" value="{{ scenario.group }}">
        </div>
        <div class="form-group">
            <label for="delay">Delay between commands (seconds):</label>
            <input type="number" class="form-control" id="delay" name="delay" value="{{ scenario.delay|default(2) }}" min="0" step="1">
        </div>
        <div class="form-group">
            <label for="timeout">Timeout (seconds):</label>
            <input type="number" class="form-control" id="timeout" name="timeout" value="{{ scenario.timeout|default(30) }}" min="1" step="1">
        </div>
        <div class="form-group">
            <label for="save_config">Save Configuration:</label>
            <select class="form-control" id="save_config" name="save_config">
                <option value="true" {% if scenario.save_config|default(false) %}selected{% endif %}>Yes</option>
                <option value="false" {% if not scenario.save_config|default(false) %}selected{% endif %}>No</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Update Scenario</button>
        <a href="{{ url_for('scenarios') }}" class="btn btn-secondary">Cancel</a>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, setting up device selection toggle...');
    
    const individualRadio = document.getElementById('select_individual');
    const groupRadio = document.getElementById('select_group');
    const individualDevices = document.getElementById('individual_devices');
    const deviceGroups = document.getElementById('device_groups');
    
    console.log('Elements found:', {
        individualRadio: individualRadio,
        groupRadio: groupRadio,
        individualDevices: individualDevices,
        deviceGroups: deviceGroups
    });

    function toggleDeviceSelection() {
        console.log('Toggling device selection...');
        console.log('Individual radio checked:', individualRadio.checked);
        console.log('Group radio checked:', groupRadio.checked);
        
        if (individualRadio.checked) {
            console.log('Showing individual devices, hiding device groups');
            individualDevices.style.display = 'block';
            deviceGroups.style.display = 'none';
        } else {
            console.log('Hiding individual devices, showing device groups');
            individualDevices.style.display = 'none';
            deviceGroups.style.display = 'block';
        }
    }

    // Initial call to set correct state
    toggleDeviceSelection();
    
    // Add event listeners
    if (individualRadio) {
        individualRadio.addEventListener('click', toggleDeviceSelection);
        individualRadio.addEventListener('change', toggleDeviceSelection);
    }
    if (groupRadio) {
        groupRadio.addEventListener('click', toggleDeviceSelection);
        groupRadio.addEventListener('change', toggleDeviceSelection);
    }
    
    console.log('Event listeners added successfully');
});
</script>
{% endblock %}


